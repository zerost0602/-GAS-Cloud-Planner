<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>일정관리 시스템</title>
  <!-- React 및 필수 라이브러리 로드 -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @keyframes pulse-orange {
      0% { background-color: #fb923c; box-shadow: 0 0 0 0 rgba(251, 146, 60, 0.7); }
      70% { background-color: #f97316; box-shadow: 0 0 0 10px rgba(251, 146, 60, 0); }
      100% { background-color: #fb923c; box-shadow: 0 0 0 0 rgba(251, 146, 60, 0); }
    }
    .btn-sync-dirty { animation: pulse-orange 2s infinite; color: white !important; }
    .donut-chart { transform: rotate(-90deg); }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    .calendar-grid-cell { min-height: 60px; }
    @media (min-width: 768px) { .calendar-grid-cell { min-height: 120px; } }
    .schedule-item-monthly { background-color: #2563eb; color: white; transition: all 0.2s ease; }
    .schedule-item-monthly:hover { background-color: #1d4ed8; transform: translateY(-1px); z-index: 10; }
    .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }
    .toast-up { animation: toastUp 0.4s ease-out forwards; }
    @keyframes toastUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
  </style>
</head>
<body class="bg-slate-50 text-slate-900 overflow-hidden">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback } = React;

    // --- 유틸리티 함수 ---
    const formatDate = (date) => {
      const d = new Date(date);
      if (isNaN(d.getTime())) return "";
      let month = '' + (d.getMonth() + 1);
      let day = '' + d.getDate();
      let year = d.getFullYear();
      if (month.length < 2) month = '0' + month;
      if (day.length < 2) day = '0' + day;
      return [year, month, day].join('-');
    };

    const formatTimeOnly = (timeVal) => {
      if (!timeVal) return "";
      // 문자열인 경우 HH:mm만 추출 (스프레드시트에서 날짜가 섞여오는 경우 대응)
      if (typeof timeVal === 'string') {
        const match = timeVal.match(/(\d{2}:\d{2})/);
        return match ? match[0] : timeVal;
      }
      // Date 객체인 경우
      const d = new Date(timeVal);
      if (!isNaN(d.getTime())) {
        return d.toTimeString().slice(0, 5);
      }
      return timeVal;
    };

    const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
    const getFirstDayOfMonth = (year, month) => new Date(year, month, 1).getDay();
    const getImpScore = (imp) => {
      if (imp === '!!!') return 3;
      if (imp === '!!') return 2;
      if (imp === '!') return 1;
      return 0;
    };

    // --- 개별 뷰 컴포넌트 (App 외부 정의하여 불필요한 전체 리렌더링 방지) ---

    const MonthlyView = ({ items, currentDate, setCurrentDate, setView, openEditor, todayStr }) => {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      const days = [];
      const startDay = getFirstDayOfMonth(year, month);
      const totalDaysCount = getDaysInMonth(year, month);
      for (let i = 0; i < startDay; i++) days.push(null);
      for (let i = 1; i <= totalDaysCount; i++) days.push(i);
      const daysOfWeek = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

      return (
        <div className="flex-1 p-2 md:p-4 overflow-auto">
          <div className="flex items-center justify-between mb-4 md:mb-6 px-1">
            <h2 className="text-lg md:text-2xl font-bold">{year}년 {month + 1}월</h2>
            <div className="flex gap-1">
              <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="p-2 bg-white border rounded hover:bg-gray-50"><i className="fas fa-chevron-left"></i></button>
              <button onClick={() => setCurrentDate(new Date())} className="px-3 py-2 bg-white border rounded font-bold text-xs shadow-sm hover:bg-gray-50">Today</button>
              <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="p-2 bg-white border rounded shadow-sm hover:bg-gray-50"><i className="fas fa-chevron-right"></i></button>
            </div>
          </div>
          <div className="grid grid-cols-7 border-t border-l border-slate-200 shadow-sm rounded-lg overflow-hidden text-[10px] md:text-xs">
            {daysOfWeek.map((day, i) => (
              <div key={day} className={`p-2 text-center font-bold border-r border-b ${i === 0 ? 'bg-red-50 text-red-500' : i === 6 ? 'bg-blue-50 text-blue-500' : 'bg-slate-50 text-slate-400'}`}>{day}</div>
            ))}
            {days.map((day, idx) => {
              const dateStr = day ? `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}` : null;
              const isToday = dateStr === todayStr;
              const daySchedules = items.filter(it => it.date === dateStr && it.type === 'Schedule').sort((a,b) => getImpScore(b.importance) - getImpScore(a.importance));
              return (
                <div key={idx} className={`calendar-grid-cell p-1 border-r border-b transition-colors ${isToday ? 'bg-blue-50/50' : 'bg-white'}`} onDoubleClick={() => day && (setCurrentDate(new Date(year, month, day)), setView('weekly'))}>
                  {day && <div className="flex flex-col h-full overflow-hidden">
                    <span className={`text-[10px] md:text-xs font-black px-1.5 py-0.5 rounded w-fit ${isToday ? 'bg-blue-600 text-white shadow-sm' : idx % 7 === 0 ? 'text-red-500' : idx % 7 === 6 ? 'text-blue-500' : 'text-slate-700'}`}>{day}</span>
                    <div className="flex flex-col gap-1 mt-1 overflow-y-auto no-scrollbar">
                      {daySchedules.map(s => (
                        <div key={s.id} onClick={(e) => { e.stopPropagation(); openEditor(s); }} className="schedule-item-monthly text-[8px] md:text-[10px] px-1.5 py-0.5 rounded truncate font-medium shadow-sm cursor-pointer">
                          {s.importance !== 'None' && <span className="mr-1 text-yellow-300 font-bold">{s.importance}</span>}{s.title}
                        </div>
                      ))}
                    </div>
                  </div>}
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const WeeklyView = ({ items, currentDate, setCurrentDate, toggleHabitStatus, openEditor, todayStr }) => {
      const curr = new Date(currentDate);
      const monday = new Date(curr.setDate(curr.getDate() - curr.getDay() + (curr.getDay() === 0 ? -6 : 1)));
      const weekDays = Array.from({length: 7}, (_, i) => new Date(new Date(monday).setDate(monday.getDate() + i)));
      const dayNames = ['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'];

      return (
        <div className="flex-1 p-3 md:p-6 overflow-auto" id="weekly-scroll-container">
           <div className="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
            <h2 className="text-xl md:text-2xl font-bold">{monday.getFullYear()}년 {monday.getMonth() + 1}월 주간 일정</h2>
            <div className="flex gap-2">
              <button onClick={() => setCurrentDate(new Date(currentDate.setDate(currentDate.getDate()-7)))} className="p-2 bg-white border rounded shadow-sm hover:bg-gray-50 flex-1 md:flex-none"><i className="fas fa-chevron-left"></i></button>
              <button onClick={() => setCurrentDate(new Date())} className="px-4 py-2 bg-white border rounded font-bold text-sm shadow-sm hover:bg-gray-50 flex-1 md:flex-none">Today</button>
              <button onClick={() => setCurrentDate(new Date(currentDate.setDate(currentDate.getDate()+7)))} className="p-2 bg-white border rounded shadow-sm hover:bg-gray-50 flex-1 md:flex-none"><i className="fas fa-chevron-right"></i></button>
            </div>
          </div>
          <div className="space-y-4">
            {weekDays.map((d) => {
              const dateStr = formatDate(d);
              const dayItems = items.filter(it => it.date === dateStr).sort((a, b) => getImpScore(b.importance) - getImpScore(a.importance));
              const dayIdx = d.getDay();
              const isDayToday = dateStr === todayStr;
              return (
                <div key={dateStr} className="flex flex-col md:flex-row gap-2 md:gap-4">
                  <div className={`w-full md:w-32 p-3 rounded-xl border-2 flex md:flex-col items-center justify-between md:justify-center bg-white shadow-sm transition-all ${isDayToday ? 'border-blue-500 bg-blue-50' : dayIdx === 0 ? 'border-red-100 text-red-500' : dayIdx === 6 ? 'border-blue-100 text-blue-500' : 'border-slate-100'}`}>
                    <div className={`text-[10px] font-black uppercase ${isDayToday ? 'text-blue-600' : 'text-slate-400'}`}>{dayNames[dayIdx]}</div>
                    <div className={`text-2xl md:text-4xl font-black ${isDayToday ? 'text-blue-700' : 'text-slate-800'}`}>{d.getDate()}</div>
                  </div>
                  <div className="flex-1 bg-white p-3 rounded-xl border border-slate-200 shadow-sm flex flex-col gap-2">
                    {dayItems.length === 0 ? <div className="text-slate-300 italic text-xs py-4 text-center">No plans recorded.</div> : 
                      dayItems.map(it => (
                        <div key={it.id} className="flex items-center gap-3 p-2.5 rounded-xl hover:bg-slate-50 cursor-pointer shadow-sm border border-transparent hover:border-slate-100" onClick={() => openEditor(it)}>
                          <div className="flex items-center gap-2">
                            {it.type === 'Habit' && (
                              <div 
                                className="w-7 h-7 flex items-center justify-center border-2 rounded-lg bg-white shadow-inner transition-all hover:scale-105 active:scale-95" 
                                onClick={(e) => { e.preventDefault(); e.stopPropagation(); toggleHabitStatus(it.id); }}
                              >
                                {it.status === 'CHECK' && <i className="fas fa-check text-green-500"></i>}
                                {it.status === 'X' && <i className="fas fa-times text-red-400"></i>}
                              </div>
                            )}
                            {it.importance !== 'None' && <span className="text-red-600 font-black text-xl">{it.importance}</span>}
                          </div>
                          <div className="flex flex-col flex-1 min-w-0">
                            <span className="font-bold text-slate-800 text-base truncate">{it.title}</span>
                            <div className="flex flex-wrap gap-3 items-center mt-0.5">
                              {it.time && <span className="text-[11px] text-slate-400 font-medium"><i className="far fa-clock mr-1"></i>{formatTimeOnly(it.time)}</span>}
                              {it.location && <span className="text-[11px] text-blue-400 font-bold truncate max-w-[150px]"><i className="fas fa-map-marker-alt mr-1"></i>{it.location}</span>}
                            </div>
                          </div>
                          <i className="fas fa-chevron-right text-slate-200 text-xs"></i>
                        </div>
                      ))
                    }
                  </div>
                </div>
              );
            })}
          </div>
        </div>
      );
    };

    const AchievementView = ({ items, currentDate }) => {
      const [targetMonth, setTargetMonth] = useState(`${currentDate.getFullYear()}-${String(currentDate.getMonth()+1).padStart(2, '0')}`);
      const filteredHabits = items.filter(it => it.type === 'Habit' && it.date && it.date.startsWith(targetMonth));
      const total = filteredHabits.length;
      const uncompleted = filteredHabits.filter(it => it.status === 'X').length;
      const completed = filteredHabits.filter(it => it.status === 'CHECK').length;
      const percentage = total === 0 ? 0 : Math.round((completed / total) * 100);
      const circumference = 2 * Math.PI * 95;
      const offset = circumference - (percentage / 100) * circumference;

      return (
        <div className="flex-1 p-4 md:p-8 overflow-y-auto no-scrollbar">
          <div className="flex flex-col items-center max-w-4xl mx-auto bg-white p-6 md:p-12 rounded-3xl shadow-lg border">
            <div className="mb-8 w-full flex flex-col md:flex-row justify-between items-center gap-4">
              <h2 className="text-lg md:text-2xl font-black text-slate-800 tracking-tight uppercase">Habit Achievement</h2>
              <input type="month" value={targetMonth} onChange={(e) => setTargetMonth(e.target.value)} className="w-full md:w-auto p-2 border rounded-xl font-bold bg-slate-50 focus:ring-2 focus:ring-blue-500 outline-none" />
            </div>
            <div className="flex flex-col md:flex-row items-center gap-12 w-full justify-center">
              <div className="relative flex items-center justify-center p-4">
                <svg width="240" height="240" viewBox="0 0 240 240" className="donut-chart md:w-[320px] md:h-[320px]">
                  <circle cx="120" cy="120" r={95} fill="transparent" stroke="#fee2e2" strokeWidth="24" />
                  <circle cx="120" cy="120" r={95} fill="transparent" stroke="#22c55e" strokeWidth="24" strokeDasharray={circumference} strokeDashoffset={offset} strokeLinecap="round" style={{ transition: 'stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1)' }} />
                </svg>
                <div className="absolute inset-0 flex flex-col items-center justify-center">
                  <span className="text-4xl md:text-6xl font-black text-slate-800 leading-none">{percentage}%</span>
                  <span className="text-[10px] text-slate-400 font-bold uppercase mt-2 tracking-widest">Done</span>
                </div>
              </div>
              <div className="w-full md:flex-1 bg-slate-50 p-8 rounded-2xl border text-center shadow-inner">
                <div className="text-slate-400 text-xs font-black uppercase mb-4 tracking-widest">Stats Summary</div>
                <div className="text-5xl md:text-7xl font-black text-slate-800 mb-2 tracking-tighter">{completed} <span className="text-slate-300 text-3xl mx-2">/</span> {total}</div>
                <div className="mt-6 text-xs text-slate-500 bg-white px-6 py-3 rounded-full shadow-sm font-bold border border-slate-100">{total - completed - uncompleted} habits left this month</div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    // --- 메인 App 컴포넌트 ---

    const App = () => {
      const [view, setView] = useState('monthly');
      const [items, setItems] = useState([]);
      const [currentDate, setCurrentDate] = useState(new Date());
      const [isSidebarOpen, setIsSidebarOpen] = useState(window.innerWidth >= 768);
      const [isEditorOpen, setIsEditorOpen] = useState(false);
      const [isSettingsOpen, setIsSettingsOpen] = useState(false);
      const [isDirty, setIsDirty] = useState(false);
      const [isLoading, setIsLoading] = useState(true);
      const [isSyncing, setIsSyncing] = useState(false);
      const [editingItem, setEditingItem] = useState(null);
      
      const [errorMsg, setErrorMsg] = useState("");
      const [toastMsg, setToastMsg] = useState("");
      const [isDeleteConfirmOpen, setIsDeleteConfirmOpen] = useState(false);

      const [settings, setSettings] = useState({ email: '', notificationHour: '08' });

      const todayStr = useMemo(() => formatDate(new Date()), []);

      const [formData, setFormData] = useState({
        title: '', date: formatDate(new Date()), time: '', location: '', description: '', type: 'Schedule', importance: 'None', status: ''
      });

      useEffect(() => {
        if (typeof google !== 'undefined') {
          google.script.run.withSuccessHandler(data => {
            setItems((data || []).map(it => ({ ...it, date: formatDate(it.date) })));
            setIsLoading(false);
          }).loadData();
          
          google.script.run.withSuccessHandler(res => {
            if(res) setSettings(res);
          }).getSettings();
        } else {
          setIsLoading(false);
        }
      }, []);

      const showToast = (msg) => {
        setToastMsg(msg);
        setTimeout(() => setToastMsg(""), 3000);
      };

      const handleSync = () => {
        setIsSyncing(true);
        if (typeof google !== 'undefined') {
          google.script.run.withSuccessHandler(() => { 
            setIsDirty(false); 
            setIsSyncing(false); 
            showToast("Cloud 저장 완료!");
          }).saveData(items);
        } else {
          setTimeout(() => { setIsDirty(false); setIsSyncing(false); showToast("로컬 저장 완료 (데모)"); }, 800);
        }
      };

      const handleSaveSettings = () => {
        setIsSyncing(true);
        if (typeof google !== 'undefined') {
          google.script.run.withSuccessHandler(() => {
            setIsSyncing(false);
            setIsSettingsOpen(false);
            showToast("메일 설정이 적용되었습니다.");
          }).saveSettings(settings);
        } else {
           setTimeout(() => { setIsSyncing(false); setIsSettingsOpen(false); showToast("설정 적용 완료 (데모)"); }, 800);
        }
      };

      const openEditor = (item = null) => {
        setErrorMsg(""); setIsDeleteConfirmOpen(false);
        if (item) { setEditingItem(item); setFormData({ ...item }); }
        else { setEditingItem(null); setFormData({ title: '', date: formatDate(new Date()), time: '', location: '', description: '', type: 'Schedule', importance: 'None', status: '' }); }
        setIsEditorOpen(true);
      };

      const saveItem = () => {
        if (!formData.title || !formData.date) { setErrorMsg("Title과 Date는 필수 입력 항목입니다."); return; }
        if (formData.time && !/^([01]\d|2[0-3]):([0-5]\d)$/.test(formData.time)) { setErrorMsg("시간 형식이 올바르지 않습니다 (HH:mm)."); return; }
        let newItems = editingItem ? items.map(it => it.id === editingItem.id ? { ...formData, id: it.id } : it) : [...items, { ...formData, id: Date.now().toString() }];
        setItems(newItems); setIsDirty(true); setIsEditorOpen(false);
      };

      const confirmDelete = () => {
        setItems(items.filter(it => it.id !== editingItem.id)); setIsDirty(true); setIsEditorOpen(false); setIsDeleteConfirmOpen(false);
      };

      const toggleHabitStatus = useCallback((id) => {
        setItems(prevItems => prevItems.map(it => {
          if (it.id === id) {
            let nextStatus = it.status === '' ? 'CHECK' : it.status === 'CHECK' ? 'X' : '';
            return { ...it, status: nextStatus };
          }
          return it;
        }));
        setIsDirty(true);
      }, []);

      const changeView = (v) => { setView(v); if (window.innerWidth < 768) setIsSidebarOpen(false); };

      return (
        <div className="flex h-screen w-full overflow-hidden font-sans relative">
          
          {/* 로딩 오버레이 */}
          {isLoading && items.length === 0 && (
            <div className="fixed inset-0 z-[200] bg-white flex flex-col items-center justify-center">
               <div className="w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-4"></div>
               <p className="font-bold text-slate-400 tracking-widest animate-pulse uppercase text-xs">Connecting to Cloud...</p>
            </div>
          )}

          {/* 성공 알림 토스트 */}
          {toastMsg && (
            <div className="fixed bottom-10 left-1/2 -translate-x-1/2 z-[300] toast-up">
              <div className="bg-slate-900 text-white px-8 py-4 rounded-2xl font-bold shadow-2xl flex items-center gap-3 border border-white/10">
                <i className="fas fa-check-circle text-green-400"></i>
                {toastMsg}
              </div>
            </div>
          )}

          {/* 사이드바 */}
          <div className={`fixed md:static inset-0 z-50 transition-all duration-300 ease-in-out overflow-hidden ${isSidebarOpen ? 'translate-x-0 w-[80%] md:w-64' : '-translate-x-full md:translate-x-0 md:w-20'} bg-slate-900 text-white flex flex-col shrink-0`}>
            <div className="p-6 flex items-center justify-between border-b border-slate-800 h-20 shrink-0">
              <div className="flex items-center gap-4">
                <button onClick={() => setIsSidebarOpen(!isSidebarOpen)} className="text-white hover:text-blue-400 transition-colors">
                  <i className={`fas ${isSidebarOpen ? 'fa-times' : 'fa-bars'} text-xl`}></i>
                </button>
                {isSidebarOpen && <span className="font-black tracking-tighter text-2xl bg-gradient-to-r from-blue-400 to-emerald-400 bg-clip-text text-transparent">PLANNER</span>}
              </div>
            </div>
            <nav className="flex-1 px-4 py-8 space-y-3">
              <button onClick={() => changeView('monthly')} className={`w-full flex items-center gap-4 p-4 rounded-xl transition-all ${view === 'monthly' ? 'bg-blue-600 shadow-lg' : 'text-slate-400 hover:bg-slate-800'}`}>
                <i className="fas fa-calendar-alt w-6 text-center text-lg"></i>
                {isSidebarOpen && <span className="font-bold whitespace-nowrap">Monthly</span>}
              </button>
              <button onClick={() => changeView('weekly')} className={`w-full flex items-center gap-4 p-4 rounded-xl transition-all ${view === 'weekly' ? 'bg-blue-600 shadow-lg' : 'text-slate-400 hover:bg-slate-800'}`}>
                <i className="fas fa-calendar-week w-6 text-center text-lg"></i>
                {isSidebarOpen && <span className="font-bold whitespace-nowrap">Weekly</span>}
              </button>
              <button onClick={() => changeView('achievement')} className={`w-full flex items-center gap-4 p-4 rounded-xl transition-all ${view === 'achievement' ? 'bg-blue-600 shadow-lg' : 'text-slate-400 hover:bg-slate-800'}`}>
                <i className="fas fa-chart-pie w-6 text-center text-lg"></i>
                {isSidebarOpen && <span className="font-bold whitespace-nowrap">Achievement</span>}
              </button>
            </nav>
            <div className="p-4 border-t border-slate-800">
              <button onClick={handleSync} disabled={isSyncing} className={`w-full flex items-center justify-center gap-3 p-4 rounded-xl text-sm font-black transition-all ${isDirty ? 'btn-sync-dirty' : 'bg-slate-800 text-slate-500'}`}>
                <i className={`fas ${isSyncing ? 'fa-spinner fa-spin' : 'fa-cloud-upload-alt'} text-lg`}></i>
                {isSidebarOpen && <span className="whitespace-nowrap">{isSyncing ? 'Syncing...' : 'Save Cloud'}</span>}
              </button>
            </div>
          </div>
          
          {isSidebarOpen && window.innerWidth < 768 && <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-40" onClick={() => setIsSidebarOpen(false)}></div>}

          <div className="flex-1 flex flex-col relative overflow-hidden bg-slate-50">
            <header className="h-20 bg-white border-b px-4 md:px-8 flex items-center justify-between shrink-0 shadow-sm z-10">
              <div className="flex items-center gap-4">
                {(!isSidebarOpen || window.innerWidth < 768) && (
                  <button onClick={() => setIsSidebarOpen(true)} className="w-10 h-10 bg-slate-900 text-white rounded-xl flex items-center justify-center shadow-lg transition-all active:scale-95">
                    <i className="fas fa-bars"></i>
                  </button>
                )}
                <h1 className="font-black text-xl uppercase text-slate-800 tracking-tight">{view} overview</h1>
              </div>
              <div className="flex items-center gap-3">
                <button onClick={() => setIsSettingsOpen(true)} className="w-10 h-10 flex items-center justify-center rounded-xl bg-slate-100 text-slate-500 hover:bg-slate-200 transition-colors shadow-sm">
                  <i className="fas fa-cog text-xl"></i>
                </button>
                <button onClick={() => openEditor()} className="bg-blue-600 text-white px-5 py-2.5 rounded-xl text-sm font-black shadow-lg shadow-blue-200 transition-transform active:scale-95">
                  <i className="fas fa-plus mr-2"></i> NEW
                </button>
              </div>
            </header>

            <main className="flex-1 flex flex-col overflow-hidden">
              {view === 'monthly' && <MonthlyView items={items} currentDate={currentDate} setCurrentDate={setCurrentDate} setView={setView} openEditor={openEditor} todayStr={todayStr} />}
              {view === 'weekly' && <WeeklyView items={items} currentDate={currentDate} setCurrentDate={setCurrentDate} toggleHabitStatus={toggleHabitStatus} openEditor={openEditor} todayStr={todayStr} />}
              {view === 'achievement' && <AchievementView items={items} currentDate={currentDate} />}
            </main>

            {/* 환경설정 모달 */}
            {isSettingsOpen && (
              <div className="fixed inset-0 bg-slate-900/60 flex items-center justify-center z-[150] p-4 backdrop-blur-md">
                <div className="bg-white w-full max-w-md rounded-3xl shadow-2xl overflow-hidden flex flex-col border border-white/20">
                  <div className="p-8 border-b flex justify-between items-center bg-slate-50/50">
                    <h3 className="text-2xl font-black text-slate-800 tracking-tight">Mail Settings</h3>
                    <button onClick={() => setIsSettingsOpen(false)} className="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-400 hover:text-red-500 transition-all"><i className="fas fa-times"></i></button>
                  </div>
                  <div className="p-8 space-y-6">
                    <div>
                      <label className="text-[10px] font-black text-slate-400 uppercase block mb-2 px-1">Receiver Email</label>
                      <input type="email" className="w-full p-4 bg-slate-100 border-2 border-transparent rounded-2xl focus:bg-white focus:border-blue-500 outline-none font-bold text-slate-700 shadow-inner" placeholder="example@gmail.com" value={settings.email} onChange={e => setSettings({...settings, email: e.target.value})} />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-slate-400 uppercase block mb-2 px-1">Notification Time (Daily)</label>
                      <select className="w-full p-4 bg-slate-100 border-2 border-transparent rounded-2xl focus:bg-white focus:border-blue-500 outline-none font-bold text-slate-700 appearance-none shadow-inner" value={settings.notificationHour} onChange={e => setSettings({...settings, notificationHour: e.target.value})}>
                        {Array.from({length: 24}).map((_, i) => (
                          <option key={i} value={String(i).padStart(2, '0')}>{String(i).padStart(2, '0')}:00</option>
                        ))}
                      </select>
                      <p className="mt-2 text-[10px] text-slate-400 px-1 font-medium">* 매일 지정된 시간에 오늘 일정을 메일로 보냅니다.</p>
                    </div>
                  </div>
                  <div className="p-8 border-t bg-slate-50/50">
                    <button onClick={handleSaveSettings} disabled={isSyncing} className="w-full bg-blue-600 text-white p-5 rounded-2xl font-black text-sm shadow-xl shadow-blue-200 transition-all active:scale-95 uppercase tracking-widest">
                      {isSyncing ? <i className="fas fa-spinner fa-spin mr-2"></i> : null}
                      {isSyncing ? 'Applying...' : 'Apply Settings'}
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* 에디터 모달 */}
            {isEditorOpen && (
              <div className="fixed inset-0 bg-slate-900/60 flex items-center justify-center z-[100] p-2 md:p-4 backdrop-blur-md">
                <div className="bg-white w-full max-w-lg rounded-3xl shadow-2xl overflow-hidden flex flex-col border border-white/20 relative">
                  {isDeleteConfirmOpen && (
                    <div className="absolute inset-0 bg-white/95 z-[120] flex flex-col items-center justify-center p-8 text-center animate-in fade-in zoom-in duration-200">
                      <div className="w-16 h-16 bg-red-100 text-red-500 rounded-full flex items-center justify-center text-2xl mb-4"><i className="fas fa-trash-alt"></i></div>
                      <h4 className="text-xl font-black text-slate-800 mb-2">삭제하시겠습니까?</h4>
                      <p className="text-slate-400 text-sm mb-8 leading-relaxed text-center px-4">이 작업은 되돌릴 수 없으며<br/>선택한 일정이 영구적으로 삭제됩니다.</p>
                      <div className="flex gap-3 w-full mt-4">
                        <button onClick={confirmDelete} className="flex-1 bg-red-500 text-white py-4 rounded-2xl font-black text-sm shadow-lg shadow-red-100 hover:bg-red-600 transition-colors">네, 삭제합니다</button>
                        <button onClick={() => setIsDeleteConfirmOpen(false)} className="flex-1 bg-slate-100 text-slate-600 py-4 rounded-2xl font-black text-sm hover:bg-slate-200 transition-colors">취소</button>
                      </div>
                    </div>
                  )}

                  <div className="p-6 md:p-8 border-b flex justify-between items-center bg-slate-50/50">
                    <div>
                      <h3 className="text-xl md:text-2xl font-black text-slate-800 tracking-tight">{editingItem ? 'Update Item' : 'Create Item'}</h3>
                      <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-1 italic">Planning Mode</p>
                    </div>
                    <button onClick={() => setIsEditorOpen(false)} className="w-10 h-10 flex items-center justify-center rounded-full bg-slate-100 text-slate-400 hover:bg-red-50 hover:text-red-500 transition-all"><i className="fas fa-times"></i></button>
                  </div>
                  
                  <div className="p-6 md:p-8 space-y-4 md:space-y-6 overflow-y-auto max-h-[65vh] no-scrollbar">
                    {errorMsg && <div className="p-4 bg-red-500 text-white rounded-2xl text-xs font-bold shake shadow-md flex items-center gap-2"><i className="fas fa-exclamation-circle"></i>{errorMsg}</div>}
                    <div>
                      <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Title *</label>
                      <input className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl focus:bg-white focus:border-blue-500 outline-none font-bold text-slate-700 text-sm md:text-base transition-all shadow-inner" placeholder="What's the plan?" value={formData.title} onChange={e => { setErrorMsg(""); setFormData({...formData, title: e.target.value}); }} />
                    </div>
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-6">
                      <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Date *</label>
                        <input type="date" className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl outline-none font-bold text-slate-700 text-sm shadow-inner" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value})} />
                      </div>
                      <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Time (HH:mm)</label>
                        <input type="text" className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl outline-none font-bold text-slate-700 text-sm shadow-inner" placeholder="HH:mm" value={formData.time} onChange={e => setFormData({...formData, time: e.target.value})} />
                      </div>
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Location</label>
                      <input className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl focus:bg-white focus:border-blue-500 outline-none font-bold text-slate-700 text-sm shadow-inner" placeholder="Where?" value={formData.location} onChange={(e) => setFormData({...formData, location: e.target.value})} />
                    </div>
                    <div>
                      <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Description</label>
                      <textarea className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl h-24 md:h-28 resize-none focus:bg-white focus:border-blue-500 outline-none font-medium text-slate-600 text-sm shadow-inner" placeholder="Details..." value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})}></textarea>
                    </div>
                    <div className="grid grid-cols-2 gap-4 md:gap-6">
                      <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Type *</label>
                        <select className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl outline-none font-bold text-slate-700 text-sm shadow-inner" value={formData.type} onChange={(e) => setFormData({...formData, type: e.target.value})}>
                          <option value="Schedule">Schedule</option>
                          <option value="Habit">Habit</option>
                        </select>
                      </div>
                      <div>
                        <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest block mb-2 px-1">Importance *</label>
                        <select className="w-full p-3 md:p-4 bg-slate-100 border-2 border-transparent rounded-xl md:rounded-2xl outline-none font-bold text-slate-700 text-sm shadow-inner" value={formData.importance} onChange={(e) => setFormData({...formData, importance: e.target.value})}>
                          <option value="None">None</option>
                          <option value="!">!</option>
                          <option value="!!">!!</option>
                          <option value="!!!">!!!</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <div className="p-6 md:p-8 border-t bg-slate-50/50 flex gap-4 shrink-0">
                    <button onClick={saveItem} className="flex-1 bg-blue-600 text-white p-4 md:p-5 rounded-2xl font-black text-sm shadow-xl shadow-blue-100 hover:bg-blue-700 transition-all active:scale-95">SAVE CHANGES</button>
                    {editingItem && (
                      <button onClick={() => setIsDeleteConfirmOpen(true)} className="px-6 md:px-8 bg-white text-red-500 border-2 border-red-50 rounded-2xl font-black text-sm hover:bg-red-50 transition-colors">DELETE</button>
                    )}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
